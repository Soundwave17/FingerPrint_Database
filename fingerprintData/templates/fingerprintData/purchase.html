{% extends 'fingerprintData/page_template.html' %}


{% block title %}{% endblock title %}
{% block navtitle %}{% endblock navtitle %}
{% block activetitle %}Purchase{% endblock activetitle %}
{% block navlinks %}
    <li class="nav-item">
        <a class="nav-link" href="{% url 'fingerprintData:checkout' customer.customer_email %}">
            <i class="fas fa-fw fa-folder"></i>
            <span> Checkout </span>
        </a>
    </li>
{% endblock navlinks %}


{% block topbar %}

    <input type="hidden" id="myVar" name="variable" value="{{ customer.customer_email }}">

    <ul class="navbar-nav ml-auto">

        <li class="nav-item dropdown arrow ">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="mr-2 d-lg-inline text-gray-600 small">Welcome, {{ customer.customer_name }}</span>
            </a>
            <!-- Dropdown - User Information -->
            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                 aria-labelledby="userDropdown">
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                    Logout
                </a>
            </div>
        </li>

    </ul>
{% endblock topbar %}

{% block content %}
    {% load static %}
    {% block extracss %}
        <link href="{% static 'css/purchase.css' %}" rel="stylesheet" type="text/css">
    {% endblock extracss %}

    {% if types %}

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                   aria-controls="home"
                   aria-selected="true">Home</a>
            </li>

            {% for type in types %}
                <li class="nav-item">
                    <a class="nav-link"
                       id="{{ type }}-tab"
                       data-toggle="tab"
                       href="#{{ type }}"
                       role="tab"
                       aria-controls="{{ type }}"
                       aria-selected="false">{{ type }}
                    </a>
                </li>
            {% endfor %}
        </ul>

        <div class="tab-content" id="myTabContent">

            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">...

            </div>
            {% for type in types %}
                <div class="tab-pane fade" id="{{ type }}" role="tabpanel" aria-labelledby="{{ type }}-tab">...
                    <div class="row justify-content-center">
                        {% if products %}
                            {% for product in products %}
                                {% if type == product.product_type %}
                                    <div class="col-md-3  border p-1 m-1 rounded border-4">
                                        <div class="card">
                                            <img class="card-img-top" src="https://picsum.photos/200/150/?random">
                                            <div class="card-block">
                                                <h4 class="card-title">{{ product.product_name }}</h4>
                                                <div class="meta">
                                                    <a href="#">Friends</a>
                                                </div>
                                                <div class="card-text">
                                                    Tawshif is a web designer living in Bangladesh.
                                                </div>
                                            </div>
                                            <div class="card-footer">
                                                <span class="float-sm-left"><img class="check-image" alt="Check"
                                                                                 src="{% static 'vendor/img/check.jpg' %}"> </span>
                                                <span class="float-sm-right"><i></i>{{ product.product_price }} â‚¬ </span>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <hr class="sidebar-divider my-4">

        <div class="row">
            <button id="checkout-btn" class="btn btn-primary"> Go to Checkout</button>
            <button id="empty-cart" class="btn btn-info"> Empty your cart</button>
        </div>

    {% endif %}
{% endblock content %}

{% block extrajs %}
    <script src="{% static 'js/demo/purchase.js' %}"></script>
    <script>
        $(document).ready(function () {
            var csrftoken = '{% csrf_token %}';
            var temp = [];
            $("#checkout-btn").on("click", function (e) {
                e.preventDefault();
                var array = $(".selected");
                if (!array.length) {
                    console.log("AAAAAAAAAA EMPTY");
                } else {
                    console.log("Product list is not empty");
                    array.each(function (index, value) {
                        temp.push($(this).children("div.card")
                            .children("div.card-block")
                            .children("h4.card-title").text());
                        console.log(temp);
                    });

                    $.ajax({
                        headers: {"X-CSRFToken": csrftoken},
                        url: 'checkout/',
                        dataType: 'text/html',
                        data: {'products': temp, "csrfmiddlewaretoken": "{{ csrf_token }}"},
                        type: 'POST',
                        success: function (result) {
                            console.log(result);
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}